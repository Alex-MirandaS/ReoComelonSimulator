<mat-card>
  <mat-card-title>Registro Receta</mat-card-title>
  <mat-card-content>
    <form (ngSubmit)="submitReceta()" [formGroup]="recetaForm">
      
      <mat-form-field style="width:100%" appearance="fill">
        <mat-label>Tipo de Receta</mat-label>
        <mat-select formControlName="id_Tipo_Receta">
          <mat-option *ngFor="let tr of tiposReceta" [value]="tr.id">
            {{ tr.tipo_receta }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field style="width:100%" appearance="fill">
        <mat-label>Nombre</mat-label>
        <input matInput formControlName="nombre">
      </mat-form-field>
      
      <mat-checkbox formControlName="es_premium">Es premium</mat-checkbox>
      
      <div style="margin-top:12px">
        <button mat-raised-button type="submit">Crear Receta</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<mat-card style="margin-top:16px">
  <mat-card-title>Agregar Ingrediente a Receta</mat-card-title>
  <mat-card-content>
    <form (ngSubmit)="submitRecetaIngred()" [formGroup]="recetaIngredForm">
      
      <mat-form-field style="width:100%" appearance="fill">
        <mat-label>Receta</mat-label>
        <mat-select formControlName="id_receta">
          <mat-option *ngFor="let r of recetas" [value]="r.id">
            {{ r.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field style="width:100%" appearance="fill">
        <mat-label>Ingrediente</mat-label>
        <mat-select formControlName="id_ingrediente">
          <mat-option *ngFor="let i of ingredientes" [value]="i.id">
            {{ i.ingrediente }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field style="width:100%" appearance="fill">
        <mat-label>Cantidad</mat-label>
        <input matInput type="number" formControlName="cantidad">
      </mat-form-field>
      
      <div style="margin-top:12px">
        <button mat-raised-button type="submit">Agregar</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<!-- Tabla Recetas -->
<mat-card style="margin-top:16px">
  <mat-card-title>Recetas</mat-card-title>
  <mat-card-content>
    <table mat-table [dataSource]="recetas" class="mat-elevation-z8" *ngIf="recetas.length > 0">

      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let r"> {{r.id}} </td>
      </ng-container>

      <!-- Tipo Receta -->
      <ng-container matColumnDef="tipoReceta">
        <th mat-header-cell *matHeaderCellDef> Tipo Receta </th>
        <td mat-cell *matCellDef="let r"> {{r.tipoReceta?.tipo_receta}} </td>
      </ng-container>

      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> Nombre </th>
        <td mat-cell *matCellDef="let r"> {{r.nombre}} </td>
      </ng-container>

      <!-- Es Premium -->
      <ng-container matColumnDef="es_premium">
        <th mat-header-cell *matHeaderCellDef> Premium </th>
        <td mat-cell *matCellDef="let r"> {{r.es_premium ? 'Sí' : 'No'}} </td>
      </ng-container>

      <!-- Botón Detalle -->
      <ng-container matColumnDef="detalle">
        <th mat-header-cell *matHeaderCellDef> Detalle </th>
        <td mat-cell *matCellDef="let r">
          <button mat-button color="primary" (click)="verDetalleReceta(r.id)">Detalle Receta</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['id','tipoReceta','nombre','es_premium','detalle']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['id','tipoReceta','nombre','es_premium','detalle'];"></tr>
    </table>

    <div *ngIf="recetas.length === 0" style="text-align:center; margin-top:8px">
      No hay recetas registradas.
    </div>
  </mat-card-content>
</mat-card>

<!-- Ingredientes de la receta seleccionada -->
<mat-card style="margin-top:16px" *ngIf="ingredientesDetalle.length > 0">
  <mat-card-title>Ingredientes de la Receta</mat-card-title>
  <mat-card-content>
    <table mat-table [dataSource]="ingredientesDetalle" class="mat-elevation-z8">

      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let i"> {{i.id}} </td>
      </ng-container>

      <ng-container matColumnDef="ingrediente">
        <th mat-header-cell *matHeaderCellDef> Ingrediente </th>
        <td mat-cell *matCellDef="let i"> {{i.ingrediente?.ingrediente}} </td>
      </ng-container>

      <ng-container matColumnDef="cantidad">
        <th mat-header-cell *matHeaderCellDef> Cantidad </th>
        <td mat-cell *matCellDef="let i"> {{i.cantidad}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['id','ingrediente','cantidad']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['id','ingrediente','cantidad'];"></tr>
    </table>
  </mat-card-content>
</mat-card>


